@if (isOpen()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Adicionar à Lista</h2>
        <button class="modal-close" (click)="closeModal()" type="button">✕</button>
      </div>

      <div class="modal-body">
        <div class="character-preview">
          <img [src]="character().image" [alt]="character().name" class="character-preview__image" />
          <div class="character-preview__info">
            <h3 class="character-preview__name">{{ character().name }}</h3>
            <p class="character-preview__status">{{ character().status }} - {{ character().species }}</p>
          </div>
        </div>

        @if (!showNewListForm()) {
          <div class="list-selection">
            @if (hasLists()) {
              <div class="form-field">
                <label for="listSelect" class="form-label">Selecionar Lista</label>
                <select
                  id="listSelect"
                  [(ngModel)]="selectedListId"
                  class="form-select"
                >
                  <option value="">Escolha uma lista...</option>
                  @for (list of lists(); track list.id) {
                    <option [value]="list.id">
                      {{ list.name }} ({{ list.characters.length }} personagens)
                    </option>
                  }
                </select>
              </div>

              <button
                class="btn btn-primary btn-block"
                (click)="onSelectList()"
                [disabled]="!selectedListId()"
                type="button"
              >
                Adicionar à Lista Selecionada
              </button>

              <div class="divider">
                <span>ou</span>
              </div>
            } @else {
              <p class="no-lists-message">
                Você ainda não possui listas criadas.
              </p>
            }

            <button
              class="btn btn-secondary btn-block"
              (click)="toggleNewListForm()"
              type="button"
            >
              ➕ Criar Nova Lista
            </button>
          </div>
        } @else {
          <div class="new-list-form">
            <div class="form-field">
              <label for="newListName" class="form-label">Nome da Lista *</label>
              <input
                type="text"
                id="newListName"
                [(ngModel)]="newListName"
                class="form-input"
                placeholder="Ex: Meus favoritos"
                maxlength="50"
              />
            </div>

            <div class="form-field">
              <label for="newListDesc" class="form-label">Descrição (opcional)</label>
              <textarea
                id="newListDesc"
                [(ngModel)]="newListDescription"
                class="form-textarea"
                placeholder="Adicione uma descrição..."
                rows="3"
                maxlength="200"
              ></textarea>
            </div>

            <div class="form-actions">
              <button
                class="btn btn-secondary"
                (click)="toggleNewListForm()"
                type="button"
              >
                Cancelar
              </button>
              <button
                class="btn btn-primary"
                (click)="onCreateAndAdd()"
                [disabled]="!newListName().trim()"
                type="button"
              >
                Criar e Adicionar
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
